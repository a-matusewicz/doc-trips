{% load links %}
{% load maps %}

{% if error %}
<p class="h4"> Maps Error: {{ error }} </p>
{% else %}

<p>
  <ul class="list-group">
    {% for leg in directions.legs %}

    {% if forloop.first %}
    <li class="list-group-item {% if leg.start_stop.over_capacity %} list-group-item-danger {% endif %}">

      <h3 class="list-group-item-heading"> From {{ leg.start_stop.location_str }} </h3>
      <p> {{ leg.start_stop.directions }} </p>

      {% include start_stop_template with start_stop=leg.start_stop %}

      <p class="h5 text-muted"> You should have {{ leg.start_stop.passenger_count }} passengers. </p>
    </li>
    {% endif %}

    {% for step in leg.steps %}
    <li class="list-group-item {% if leg.start_stop.over_capacity %} list-group-item-danger {% endif %}">
      {{ step.html_instructions|safe }} &mdash; {{ step.distance.text }}
    </li>
    {% endfor %}
    
    <li class="list-group-item {% if leg.end_stop.over_capacity %} list-group-item-danger {% endif %}">
      <h3 class="list-group-item-heading"> 
	{{ leg.end_stop.location_str }} 
      </h3> 
      <p> {{ leg.end_stop.directions }} </p>

      {% include end_stop_template with end_stop=leg.end_stop %}

      {% if leg.end_stop.over_capacity %}
      <p class="h5"> <i class="fa fa-warning"></i> Over capacity! There are <strong>{{ leg.end_stop.passenger_count }}</strong> passengers on this leg. </p>
      {% endif %}

      <p class="h5 text-muted"> You should have {{ leg.end_stop.passenger_count }} passengers. </p>

    </li>
    {% endfor %}
  </ul>
{% endif %}

{% extends "db/base.html" %}
{% load links %}
{% load icons %}
{% load crispy_forms_tags %}

{% block header %}
<h3> Volunteers </h3>
{% endblock %}

{% block right_column %}
{% crispy applications_filter.form %}
{% endblock %}

{% block content %}

<div class="panel panel-info">
  <div class="panel-heading" role="tab" id="emailsHeading">
    <h4 class="panel-title">
      <a class="collapsed" data-toggle="collapse" href="#collapsedEmails" aria-expanded="false" aria-controls="collapsedEmails">
	Email list <span class="fa fa-caret-down"></span> 
      </a>
    </h4>
  </div>
  <div id="collapsedEmails" class="panel-collapse collapse" role="tabpanel" aria-labelledby="emailsHeading">
    <div class="panel-body">
      <div id="emails">
	{{ emails|join:", " }}
      </div>
    </div>
  </div>
</div>

<table class="table table-condensed">
  <thead>
    <tr>

      <th data-sort="string-ins"> 
	<span class="fa fa-sort"></span> 
	Applications <span class="badge"> {{ applications.count }}
      </th>

      <th data-sort="string"> 
	<span class="fa fa-sort"></span> 
	Status
      </th>

      <th data-sort="float" data-sort-default="desc"> 
	<span class="fa fa-sort"></span> 
	Leader Score 
      </th>

      <th data-sort="float" data-sort-default="desc"> 
	<span class="fa fa-sort"></span> 
	Croo Score 
      </th>

      <th> Leader Application </th>
      <th> Croo Application </th>
      <th/>
      <th/>

    </tr>
  </thead>

  <tbody>
  {% for application in applications %}
  <tr> 
    <td> {{ application | detail_link }} </td>

    <td> <a href="{% url 'db:update_application_status' trips_year=application.trips_year pk=application.pk %}"> {{ application.status }} </a></td>

    <td {% if not application.avg_leader_grade %} data-sort-value="0" {% endif %}> 
      {{ application.avg_leader_grade|default:"" }} 
    </td>

    <td {% if not application.avg_croo_grade %} data-sort-value="0" {% endif %}> 
      {{ application.avg_croo_grade|default:"" }} 
    </td>

    <td> {{ application.leader_application_complete | ok_if_true }} </td>
    <td> {{ application.croo_application_complete | ok_if_true }} </td>

    <td> {{ application | detail_link:"view" }}</td>
    <td> {{ application | edit_link }} </td>

  </tr>
  {% endfor %}
  </tbody>
</table>

{% endblock content %}

{% block scripts %}
<script type="text/javascript">
  $(function() {
  $("table").stupidtable();
  });
</script>
{% endblock %}

{% load links %}

<ul class="list-group">
  {% for leg in directions.legs %}

  {% if forloop.first %}
  <li class="list-group-item {% if leg.start_stop.over_capacity %} list-group-item-danger {% endif %}">

    <h3 class="list-group-item-heading"> From {{ leg.start_stop.location_str }} </h3>

    {% if leg.start_stop.trips_picked_up %}
    <p class="h5"> Pickup {{ leg.start_stop.trips_picked_up|detail_link }} </p>
    {% endif %}

  </li>
  {% endif %}

  {% for step in leg.steps %}
  <li class="list-group-item {% if leg.start_stop.over_capacity %} list-group-item-danger {% endif %}">
    {{ step.html_instructions|safe }} &mdash; {{ step.distance.text }}
  </li>
  {% endfor %}
  
  <li class="list-group-item {% if leg.end_stop.over_capacity %} list-group-item-danger {% endif %}">
    <h3 class="list-group-item-heading"> 
      {{ leg.end_stop.location_str }} 
    </h3> 
    <p> {{ leg.end_stop.directions }} </p>

    {% if leg.end_stop.trips_dropped_off %}
    <p class="h5"> Dropoff {{ leg.end_stop.trips_dropped_off|detail_link }} </p>
    {% endif %}
    
    {% if leg.end_stop.trips_picked_up %}
    <p class="h5"> Pickup {{ leg.end_stop.trips_picked_up|detail_link }} </p>
    {% endif %}

    {% if leg.end_stop.over_capacity %}
    <p class="h5"> <i class="fa fa-warning"></i> Over capacity! There are <strong>{{ leg.end_stop.passenger_count }}</strong> passengers on this leg. </p>
    {% endif %}

  </li>
  {% endfor %}
</ul>
